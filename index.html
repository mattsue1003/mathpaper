<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨‚é½¡è…¦åŠ›æ¿€ç›ª - æ•¸å­¸é¡Œç›®ç”¢ç”Ÿå™¨</title>
    
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- å¼•å…¥ Babel ç”¨æ–¼è§£æ JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- å¼•å…¥ html2pdf.js ç”¨æ–¼ç”¢ç”Ÿ PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        @media print {
            @page {
                size: A4;
                margin: 0;
            }
            body {
                background: white;
                color: black;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .no-print {
                display: none !important;
            }
            .break-after-page {
                page-break-after: always;
                break-after: page;
            }
            /* åˆ—å°æ™‚éš±è—æ²è»¸ä¸¦é‡è¨­å¯¬åº¦ */
            .print-reset-width {
                width: 100% !important;
                min-width: 0 !important;
                max-width: none !important;
                padding: 0 !important;
                overflow: visible !important;
            }
        }
        /* ç¢ºä¿è¢å¹•é¡¯ç¤ºæ™‚æœ‰é©ç•¶çš„å­—é«” */
        body {
            font-family: system-ui, -apple-system, sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // --- è¨­å®šé è¨­åœ–ç‰‡ç¶²å€ ---
        // ç‚ºäº†é¿å… CORS è·¨åŸŸå•é¡Œå°è‡´ PDF ç”¢ç”Ÿå¤±æ•—ï¼Œå°‡é è¨­ Logo æ”¹ç‚º Base64 SVG (é¡¯ç¤º Adlers æ–‡å­—)
        const DEFAULT_LOGO_URL = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxNTAnIGhlaWdodD0nNTAnIHZpZXdCb3g9JzAgMCAxNTAgNTAnPjx0ZXh0IHg9JzUwJScgeT0nNTAlJyBkb21pbmFudC1iYXNlbGluZT0nbWlkZGxlJyB0ZXh0LWFuY2hvcj0nbWlkZGxlJyBmb250LWZhbWlseT0nc2Fucy1zZXJpZicgZm9udC13ZWlnaHQ9J2JvbGQnIGZvbnQtc2l6ZT0nMzAnIGZpbGw9JyMyNTYzRUInPkFkbGVyczwvdGV4dD48L3N2Zz4=";
        
        // è¨­è¨ˆè€…ç…§ç‰‡
        const DESIGNER_IMG_URL = "https://scontent.ftpe7-4.fna.fbcdn.net/v/t39.30808-6/504017196_1312157197585884_2666464946863199959_n.jpg?_nc_cat=107&ccb=1-7&_nc_sid=6ee11a&_nc_ohc=m30xFTgOzOAQ7kNvwFH3QzL&_nc_oc=Adn3W9VZculBierHfF_7R9PXKhMHZO-D7bUAaFGTVHse2XhAt5wxukHQp8Xv4uNf37E&_nc_zt=23&_nc_ht=scontent.ftpe7-4.fna&_nc_gid=84_HD62j0UJn3n4ZfCvQag&oh=00_AfnlBt8VQKebztsfOVifzYuVG2fpMKjXYeI7WkY6yT1H1g&oe=69547C8B";

        // --- åœ–ç¤ºçµ„ä»¶ (Inline SVGs) ---
        const IconPrinter = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
        );
        const IconSettings = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
        );
        const IconRefresh = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v6h6"></path><path d="M21 12A9 9 0 0 0 6 5.3L3 8"></path><path d="M21 22v-6h-6"></path><path d="M3 12a9 9 0 0 0 15 6.7l3-2.7"></path></svg>
        );
        const IconImage = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
        );
        const IconDownload = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
        );
        const IconLoading = () => (
            <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
        );
        
        // --- ä¸»ç¨‹å¼ ---
        const MathGenerator = () => {
            // è¨­å®šç‹€æ…‹
            const [config, setConfig] = useState({
                difficulty: 'easy', // easy, medium, hard
                problemCount: 20,   // æ¯é é¡Œç›®æ•¸
                includeAnswers: true, // æ˜¯å¦åŒ…å«ç­”æ¡ˆé 
                numberOfSets: 1,    // ç”¢ç”Ÿå¹¾ä»½ä¸åŒçš„è©¦å·
                operators: {
                    add: true,
                    sub: true,
                    mul: false,
                    div: false
                }
            });

            const [generatedSheets, setGeneratedSheets] = useState([]);
            const [logoUrl, setLogoUrl] = useState(DEFAULT_LOGO_URL);
            const [isGenerating, setIsGenerating] = useState(false);

            // é›£åº¦è¨­å®šå°æ‡‰è¡¨
            const difficultySettings = {
                easy: { min: 1, max: 20, label: 'ç°¡å–® (20ä»¥å…§åŠ æ¸›)', allowMulDiv: false },
                medium: { min: 10, max: 99, label: 'ä¸­ç­‰ (å…©ä½æ•¸åŠ æ¸›)', allowMulDiv: false },
                hard: { min: 10, max: 999, label: 'æŒ‘æˆ° (ä¸‰ä½æ•¸èˆ‡ä¹˜é™¤)', allowMulDiv: true }
            };

            // è™•ç† Logo ä¸Šå‚³
            const handleLogoUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const objectUrl = URL.createObjectURL(file);
                    setLogoUrl(objectUrl);
                }
            };

            // äº‚æ•¸ç”¢ç”Ÿå™¨
            const getRandomInt = (min, max) => {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            };

            // ç”¢ç”Ÿå–®ä¸€é¡Œç›®
            const generateProblem = (mode) => {
                let num1, num2, operator, answer, symbol;
                
                // æ±ºå®šé‹ç®—ç¬¦è™Ÿ
                const activeOps = [];
                if (config.operators.add) activeOps.push('add');
                if (config.operators.sub) activeOps.push('sub');
                if (mode === 'hard' && config.operators.mul) activeOps.push('mul');
                if (mode === 'hard' && config.operators.div) activeOps.push('div');

                // å¦‚æœæ²’æœ‰é¸ä»»ä½•é‹ç®—ç¬¦è™Ÿï¼Œé è¨­ç‚ºåŠ æ³•
                const op = activeOps.length > 0 
                    ? activeOps[getRandomInt(0, activeOps.length - 1)] 
                    : 'add';

                const range = difficultySettings[mode];

                switch (op) {
                    case 'add':
                        symbol = '+';
                        num1 = getRandomInt(range.min, range.max);
                        num2 = getRandomInt(range.min, range.max);
                        answer = num1 + num2;
                        break;
                    case 'sub':
                        symbol = '-';
                        num1 = getRandomInt(range.min, range.max);
                        num2 = getRandomInt(range.min, num1); // ç¢ºä¿ä¸å‡ºç¾è² æ•¸
                        answer = num1 - num2;
                        break;
                    case 'mul':
                        symbol = 'Ã—';
                        // ä¹˜æ³•ç‚ºäº†é¿å…æ•¸å­—å¤ªå¤§ï¼Œæˆ‘å€‘é™åˆ¶ä¹˜æ•¸è¼ƒå°
                        num1 = getRandomInt(2, 20); 
                        num2 = getRandomInt(2, 9);
                        answer = num1 * num2;
                        break;
                    case 'div':
                        symbol = 'Ã·';
                        // é™¤æ³•é‚è¼¯ï¼šå…ˆæ±ºå®šç­”æ¡ˆå’Œé™¤æ•¸ï¼Œåæ¨è¢«é™¤æ•¸ï¼Œç¢ºä¿æ•´é™¤
                        answer = getRandomInt(2, 12);
                        num2 = getRandomInt(2, 9);
                        num1 = answer * num2;
                        break;
                    default:
                        symbol = '+';
                        num1 = 1; num2 = 1; answer = 2;
                }

                return { num1, num2, symbol, answer };
            };

            // ç”¢ç”Ÿæ‰€æœ‰è©¦å·
            const generateSheets = () => {
                const newSheets = [];
                
                for (let i = 0; i < config.numberOfSets; i++) {
                    const problems = [];
                    for (let j = 0; j < config.problemCount; j++) {
                        problems.push(generateProblem(config.difficulty));
                    }
                    
                    const sheetId = `S-${Date.now().toString().slice(-4)}-${i+1}`;
                    newSheets.push({
                        id: sheetId,
                        index: i + 1,
                        problems: problems,
                        date: new Date().toLocaleDateString('zh-TW')
                    });
                }
                setGeneratedSheets(newSheets);
            };

            // åˆå§‹è¼‰å…¥æ™‚ç”¢ç”Ÿä¸€æ¬¡
            useEffect(() => {
                generateSheets();
            }, []);

            // è™•ç†åˆ—å°
            const handlePrint = () => {
                window.print();
            };

            // è™•ç†ç›´æ¥ä¸‹è¼‰ PDF
            const handleDownloadPDF = () => {
                if (isGenerating) return;
                
                setIsGenerating(true);
                
                // å»¶é²ä¸€é»é»è®“ UI æ›´æ–°ï¼Œå†åŸ·è¡Œ PDF ç”¢ç”Ÿ
                setTimeout(() => {
                    const element = document.getElementById('printable-area');
                    const opt = {
                        margin:       0,
                        filename:     `æ¨‚é½¡æ•¸å­¸é¡Œç›®_${new Date().toISOString().split('T')[0]}.pdf`,
                        image:        { type: 'jpeg', quality: 0.98 },
                        html2canvas:  { scale: 2, useCORS: true, scrollY: 0 },
                        jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
                        pagebreak:    { mode: ['avoid-all', 'css', 'legacy'] }
                    };

                    html2pdf().set(opt).from(element).save()
                        .then(() => {
                            setIsGenerating(false);
                        })
                        .catch((err) => {
                            console.error(err);
                            alert("PDF ç”¢ç”Ÿå¤±æ•—ï¼Œå¯èƒ½æ˜¯åœ–ç‰‡è·¨åŸŸå•é¡Œã€‚è«‹å˜—è©¦ä¸Šå‚³è‡ªè¨‚ Logoï¼Œæˆ–ä½¿ç”¨ã€Œåˆ—å°é¡Œç›®ã€åŠŸèƒ½ä¸¦é¸æ“‡ã€Œå¦å­˜ç‚º PDFã€ã€‚");
                            setIsGenerating(false);
                        });
                }, 200); // å¢åŠ å»¶é²æ™‚é–“ç¢ºä¿æ¸²æŸ“å®Œæˆ
            };

            // é›£åº¦è®Šæ›´è™•ç†
            const handleDifficultyChange = (e) => {
                const diff = e.target.value;
                setConfig(prev => ({
                    ...prev,
                    difficulty: diff,
                    // å¦‚æœåˆ‡æ›åˆ°é hardï¼Œå¼·åˆ¶é—œé–‰ä¹˜é™¤
                    operators: {
                        ...prev.operators,
                        mul: diff === 'hard' ? prev.operators.mul : false,
                        div: diff === 'hard' ? prev.operators.div : false,
                    }
                }));
            };

            return (
                <div className="min-h-screen flex flex-col">
                    {/* --- æ§åˆ¶é¢æ¿ (åˆ—å°æ™‚éš±è—) --- */}
                    <div className="no-print bg-white shadow-md p-6 sticky top-0 z-20">
                        <div className="max-w-6xl mx-auto">
                            <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                                <h1 className="text-2xl font-bold text-blue-600 flex items-center gap-3">
                                    {/* Logo åœ¨ç¶²é æ¨™é¡Œ */}
                                    <img 
                                        src={logoUrl} 
                                        alt="Logo" 
                                        className="h-10 object-contain max-w-[150px]"
                                        onError={(e) => { e.target.style.display = 'none'; }} 
                                    />
                                    æ¨‚é½¡è…¦åŠ›æ¿€ç›ª - æ•¸å­¸é¡Œç›®ç”¢ç”Ÿå™¨
                                </h1>
                                <div className="flex gap-2 w-full md:w-auto">
                                     <button 
                                        onClick={handleDownloadPDF}
                                        disabled={isGenerating}
                                        className={`flex-1 md:flex-none justify-center bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded-lg font-bold flex items-center gap-2 shadow-lg transition-all ${isGenerating ? 'opacity-70 cursor-not-allowed' : ''}`}
                                    >
                                        {isGenerating ? <IconLoading /> : <IconDownload />}
                                        {isGenerating ? 'ç”¢ç”Ÿä¸­...' : 'ä¸‹è¼‰ PDF'}
                                    </button>
                                    <button 
                                        onClick={handlePrint}
                                        className="flex-1 md:flex-none justify-center bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-lg font-bold flex items-center gap-2 shadow-lg transition-all"
                                    >
                                        <IconPrinter />
                                        åˆ—å°é¡Œç›®
                                    </button>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 bg-gray-50 p-4 rounded-xl border border-gray-200">
                                {/* é›£åº¦è¨­å®š */}
                                <div className="space-y-2">
                                    <label className="text-sm font-semibold text-gray-600 flex items-center gap-1">
                                        <IconSettings /> é›£åº¦é¸æ“‡
                                    </label>
                                    <select 
                                        value={config.difficulty}
                                        onChange={handleDifficultyChange}
                                        className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                                    >
                                        <option value="easy">ç°¡å–® (20ä»¥å…§åŠ æ¸›)</option>
                                        <option value="medium">ä¸­ç­‰ (å…©ä½æ•¸åŠ æ¸›)</option>
                                        <option value="hard">æŒ‘æˆ° (å«ä¹˜é™¤æ³•)</option>
                                    </select>
                                </div>

                                {/* é¡Œå‹é¸æ“‡ */}
                                <div className="space-y-2">
                                    <label className="text-sm font-semibold text-gray-600">é‹ç®—ç¬¦è™Ÿ</label>
                                    <div className="flex gap-2 flex-wrap">
                                        <button 
                                            onClick={() => setConfig(p => ({...p, operators: {...p.operators, add: !p.operators.add}}))}
                                            className={`px-3 py-1 rounded border ${config.operators.add ? 'bg-blue-100 border-blue-500 text-blue-700' : 'bg-white border-gray-300 text-gray-400'}`}
                                        >ï¼‹</button>
                                        <button 
                                            onClick={() => setConfig(p => ({...p, operators: {...p.operators, sub: !p.operators.sub}}))}
                                            className={`px-3 py-1 rounded border ${config.operators.sub ? 'bg-blue-100 border-blue-500 text-blue-700' : 'bg-white border-gray-300 text-gray-400'}`}
                                        >ï¼</button>
                                        {config.difficulty === 'hard' && (
                                            <>
                                                <button 
                                                    onClick={() => setConfig(p => ({...p, operators: {...p.operators, mul: !p.operators.mul}}))}
                                                    className={`px-3 py-1 rounded border ${config.operators.mul ? 'bg-blue-100 border-blue-500 text-blue-700' : 'bg-white border-gray-300 text-gray-400'}`}
                                                >Ã—</button>
                                                <button 
                                                    onClick={() => setConfig(p => ({...p, operators: {...p.operators, div: !p.operators.div}}))}
                                                    className={`px-3 py-1 rounded border ${config.operators.div ? 'bg-blue-100 border-blue-500 text-blue-700' : 'bg-white border-gray-300 text-gray-400'}`}
                                                >Ã·</button>
                                            </>
                                        )}
                                    </div>
                                </div>

                                {/* ç”¢ç”Ÿä»½æ•¸èˆ‡ Logo è¨­å®š */}
                                <div className="space-y-2">
                                    <label className="text-sm font-semibold text-gray-600">ç”¢ç”Ÿä»½æ•¸</label>
                                    <input 
                                        type="number" 
                                        min="1" 
                                        max="20"
                                        value={config.numberOfSets}
                                        onChange={(e) => setConfig({...config, numberOfSets: parseInt(e.target.value) || 1})}
                                        className="w-full p-2 mb-2 border border-gray-300 rounded-md"
                                    />
                                    
                                    <label className="text-sm font-semibold text-gray-600 flex items-center gap-1 mt-2">
                                        <IconImage /> è‡ªè¨‚ Logo
                                    </label>
                                    <div className="flex items-center gap-2">
                                        <label className="cursor-pointer bg-white border border-gray-300 text-gray-700 px-3 py-1 rounded text-sm hover:bg-gray-50 flex-1 text-center truncate">
                                            é¸æ“‡æª”æ¡ˆ
                                            <input 
                                                type="file" 
                                                accept="image/*" 
                                                onChange={handleLogoUpload}
                                                className="hidden"
                                            />
                                        </label>
                                        <button 
                                            onClick={() => setLogoUrl(DEFAULT_LOGO_URL)}
                                            className="text-xs text-gray-500 underline whitespace-nowrap"
                                            title="é‚„åŸç‚ºé è¨­åœ–ç‰‡"
                                        >
                                            é‚„åŸ
                                        </button>
                                    </div>
                                </div>

                                {/* å…¶ä»–é¸é … */}
                                <div className="space-y-2 flex flex-col justify-end">
                                    <label className="flex items-center gap-2 cursor-pointer select-none">
                                        <input 
                                            type="checkbox"
                                            checked={config.includeAnswers}
                                            onChange={(e) => setConfig({...config, includeAnswers: e.target.checked})}
                                            className="w-5 h-5 text-blue-600 rounded focus:ring-blue-500"
                                        />
                                        <span className="text-gray-700">ç”¢ç”Ÿç­”æ¡ˆé </span>
                                    </label>
                                    
                                    <button 
                                        onClick={generateSheets}
                                        className="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-md font-semibold flex items-center justify-center gap-2 shadow transition-colors"
                                    >
                                        <IconRefresh /> é‡æ–°ç”¢ç”Ÿé¡Œç›®
                                    </button>
                                </div>
                            </div>
                            <p className="mt-4 text-sm text-gray-500 bg-blue-50 p-2 rounded inline-block md:block hidden">
                                ğŸ’¡ æç¤ºï¼šé»æ“Šã€Œä¸‹è¼‰ PDFã€å¾Œï¼Œåœ¨ç›®çš„åœ°é¸æ“‡ã€Œå¦å­˜ç‚º PDFã€å³å¯å„²å­˜æª”æ¡ˆã€‚
                            </p>
                             <p className="mt-4 text-sm text-gray-500 bg-blue-50 p-2 rounded block md:hidden">
                                ğŸ’¡ æ‰‹æ©Ÿç‰ˆæç¤ºï¼šå·¦å³æ»‘å‹•ä¸‹æ–¹é è¦½å€å¯æŸ¥çœ‹å®Œæ•´ A4 é é¢ã€‚
                            </p>
                        </div>
                    </div>

                    {/* --- åˆ—å°å€åŸŸ (å¤–å±¤å¢åŠ æ²å‹•) --- */}
                    <div className="flex-grow w-full overflow-x-auto bg-gray-200/50 p-4 md:p-8 print-reset-width">
                        <div 
                            id="printable-area" 
                            className={`mx-auto w-[210mm] print:w-full print:max-w-none bg-transparent ${isGenerating ? 'p-0' : 'flex flex-col gap-8'}`}
                        >
                            
                            {/* éæ­·æ¯ä¸€ä»½è©¦å· */}
                            {generatedSheets.map((sheet, sIndex) => (
                                <React.Fragment key={sheet.id}>
                                    
                                    {/* é¡Œç›®å· */}
                                    <div className={`bg-white p-10 relative box-border break-after-page mx-auto w-full ${isGenerating ? 'shadow-none h-[296mm]' : 'shadow-xl min-h-[296mm]'}`}>
                                        
                                        {/* ğŸ“Œ ä¿®æ”¹é‡é»ï¼šLogo ç§»è‡³ä¸Šæ–¹ä¸­å¤®ï¼Œä¸¦ç¸®å°è‡³ h-14 (ç´„åŸæœ¬çš„ 90%) */}
                                        <img 
                                            src={logoUrl} 
                                            alt="Logo" 
                                            crossOrigin="anonymous"
                                            onError={(e) => { e.target.style.display = 'none'; }}
                                            className="absolute top-5 left-1/2 -translate-x-1/2 h-14 object-contain max-w-[200px]" 
                                        />

                                        {/* é é¦–ï¼šç§»é™¤ mt-10ï¼Œæ¢å¾©åŸæœ¬æ’ç‰ˆ */}
                                        <div className="border-b-2 border-gray-800 pb-4 mb-8 flex justify-between items-end">
                                            <div>
                                                <h2 className="text-3xl font-bold text-gray-900 mb-2">æ¯æ—¥è…¦åŠ›é«”æ“</h2>
                                                <p className="text-lg text-gray-600">é›£åº¦ï¼š{difficultySettings[config.difficulty].label.split(' ')[0]} | è©¦å·ç·¨è™Ÿï¼š{sheet.id}</p>
                                            </div>
                                            <div className="text-right flex flex-col items-end">
                                                <div className="text-xl mb-1">å§“åï¼š________________</div>
                                                <div className="text-lg text-gray-500">æ—¥æœŸï¼š{sheet.date} | åˆ†æ•¸ï¼š________</div>
                                            </div>
                                        </div>

                                        {/* é¡Œç›®ç¶²æ ¼ */}
                                        <div className="grid grid-cols-2 gap-x-12 gap-y-12">
                                            {sheet.problems.map((prob, pIndex) => (
                                                <div key={pIndex} className="flex items-center text-3xl font-mono border-b border-gray-300 pb-2">
                                                    <span className="w-8 text-gray-400 text-xl font-sans mr-2">{pIndex + 1}.</span>
                                                    <div className="flex-1 flex justify-between items-center px-4 font-semibold text-gray-800">
                                                        <span className="w-16 text-right">{prob.num1}</span>
                                                        <span className="mx-4">{prob.symbol}</span>
                                                        <span className="w-16 text-left">{prob.num2}</span>
                                                        <span className="mx-2">=</span>
                                                        <span className="flex-1"></span> {/* ç©ºç™½è®“é•·è¼©å¡«å¯« */}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>

                                        {/* é å°¾ */}
                                        <div className="absolute bottom-10 left-0 w-full text-center text-gray-400 text-sm">
                                            ä¿æŒå¿ƒæƒ…æ„‰å¿«ï¼Œå‹•å‹•è…¦æ›´æœ‰æ´»åŠ›ï¼ | ç¬¬ {sIndex + 1} ä»½ï¼Œå…± {config.numberOfSets} ä»½
                                        </div>
                                    </div>

                                    {/* ç­”æ¡ˆå· (å¦‚æœæœ‰çš„è©±) */}
                                    {config.includeAnswers && (
                                        <div className={`bg-white p-10 relative box-border break-after-page mx-auto w-full ${isGenerating ? 'shadow-none h-[296mm]' : 'shadow-xl min-h-[296mm]'}`}>
                                            
                                            {/* ğŸ“Œ è§£ç­”é  Logo ä¹Ÿæ¯”ç…§è¾¦ç† */}
                                            <img 
                                                src={logoUrl} 
                                                alt="Logo" 
                                                crossOrigin="anonymous"
                                                onError={(e) => { e.target.style.display = 'none'; }}
                                                className="absolute top-5 left-1/2 -translate-x-1/2 h-14 object-contain max-w-[200px]" 
                                            />

                                            {/* ç­”æ¡ˆå·é é¦–ï¼šç§»é™¤ mt-10 */}
                                            <div className="border-b-2 border-gray-400 pb-2 mb-6 flex justify-between items-end">
                                                <div>
                                                    <h2 className="text-2xl font-bold text-gray-700">åƒè€ƒè§£ç­”</h2>
                                                    <p className="text-gray-500">è©¦å·ç·¨è™Ÿï¼š{sheet.id}</p>
                                                </div>
                                            </div>

                                            {/* ç­”æ¡ˆç¶²æ ¼ (æ¯”è¼ƒå¯†é›†) */}
                                            <div className="grid grid-cols-4 gap-6">
                                                {sheet.problems.map((prob, pIndex) => (
                                                    <div key={pIndex} className="border border-gray-200 p-3 rounded bg-gray-50 flex flex-col items-center">
                                                        <span className="text-xs text-gray-400 mb-1">ç¬¬ {pIndex + 1} é¡Œ</span>
                                                        <div className="text-lg font-mono text-gray-600">
                                                            {prob.num1} {prob.symbol} {prob.num2}
                                                        </div>
                                                        <div className="text-2xl font-bold text-red-600 mt-1">
                                                            = {prob.answer}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                             <div className="absolute bottom-10 left-0 w-full text-center text-gray-400 text-sm">
                                                è§£ç­”é  - è«‹åœ¨å®Œæˆå¾Œå†æ ¸å°å“¦ï¼
                                            </div>
                                        </div>
                                    )}

                                </React.Fragment>
                            ))}
                        </div>
                    </div>

                    {/* --- é å°¾ (è¨­è¨ˆè€…è³‡è¨Š) - åˆ—å°æ™‚éš±è— --- */}
                    <footer className="no-print mt-12 py-10 bg-white border-t border-gray-200">
                        <div className="max-w-4xl mx-auto text-center px-4">
                            <div className="flex flex-col items-center gap-4">
                                <div className="relative group">
                                    <div className="absolute -inset-1 bg-gradient-to-r from-blue-600 to-cyan-500 rounded-full blur opacity-25 group-hover:opacity-50 transition duration-200"></div>
                                    <img 
                                        src={DESIGNER_IMG_URL} 
                                        referrerPolicy="no-referrer"
                                        alt="è¨­è¨ˆè€… é¾å­Ÿä¿®" 
                                        className="relative w-32 h-32 rounded-full object-cover shadow-xl border-4 border-white"
                                    />
                                </div>
                                <div className="space-y-1">
                                    <h3 className="text-xl font-bold text-gray-800">æ„›è¿ªæ¨‚ï½œé¾å­Ÿä¿®</h3>
                                    <p className="text-gray-600 font-medium">è·èƒ½æ²»ç™‚å¸«</p>
                                </div>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MathGenerator />);
    </script>
</body>
</html>
